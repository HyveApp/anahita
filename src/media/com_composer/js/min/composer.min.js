/*! anahita 20-06-2015 */
!function(a,b,c){"use strict";if(a.widget("anahita.composerform",{options:{stories:"#an-stories",form:".composer-form"},_create:function(){var b=a(this.element);if("multipart/form-data"===b.attr("enctype")){var c=new FormData(b[0]);c.append("composed",!0),c.append("format","raw"),this._on(b,{submit:function(d){d.preventDefault(),b.trigger("beforeSubmit"),a.each(b.serializeArray(),function(a,b){c.append(b.name,b.value)}),a.each(b.find(":file")[0].files,function(a,b){c.append("file",b)}),a.ajax({url:b.attr("action"),processData:!1,contentType:!1,data:c,method:"post",beforeSend:function(){b.find(":submit").button("loading")},success:function(b){a(this.element).trigger("reset"),a(this.options.stories).prepend(a(b).fadeIn("slow"))}.bind(this),complete:function(){b.find(":submit").button("reset")}})}})}else this._on(b,{submit:function(c){c.preventDefault(),b.trigger("beforeSubmit"),a.ajax({url:b.attr("action"),data:b.serialize()+"&composed=1",method:"post",beforeSend:function(){b.find(":submit").button("loading")},success:function(b){a(this.element).trigger("reset"),a(this.options.stories).prepend(a(b).fadeIn("slow"))}.bind(this),complete:function(){b.find(":submit").button("reset")}})}})}}),a.widget("anahita.composer",{options:{composerTab:".tab-content-item",formPlaceholder:"a.form-placeholder",composerForm:".composer-form",composerMenu:"#composer-menu li",composerMenuTitle:".composer-button-title"},_create:function(){this.firstTime=!0,this.currentTabIndex=0,this.tabs=this.element.find(this.options.composerTab);var b=this.options.formPlaceholder;this.tabs.each(function(c,d){a(d).data("placeholder",a(d).find(b))}),this._on(a(this.options.composerMenu),{click:function(b){b.preventDefault();var c=a(b.delegateTarget);a(this.options.composerMenuTitle).text(c.find("a").attr("title")),this.selectTab(c.index())}}),this._on(a(this.options.composerTab),{elem:a(this.options.formPlaceholder),click:function(b){b.stopPropagation(),this.showTabContent(a(b.delegateTarget).index())}}),this._on({elem:a(this),clickoutside:function(a){this.hideTabContent(this.currentTabIndex)}}),this.selectTab(this.currentTabIndex)},selectTab:function(b){var c=this;a(this.tabs[this.currentTabIndex]).hide(),this.currentTabIndex=b;var d=a(this.tabs[this.currentTabIndex]);return d.data("content")||a.ajax({method:"get",url:d.data("url"),beforeSend:function(){c.firstTime||c.element.fadeTo("fast",.8).addClass("uiActivityIndicator")},success:function(b){d.append(b),a(d).find("form.composer-form").composerform(),d.data("content",d.find(c.options.composerForm)),c.firstTime&&(c.firstTime=!1,c.hideTabContent(c.currentTabIndex))},complete:function(){c.element.fadeTo("fast",1).removeClass("uiActivityIndicator")}}),this.firstTime||this.showTabContent(this.currentTabIndex),d.fadeIn(),this},showTabContent:function(b){var c=a(this.tabs[b]);a(c.data("placeholder")).hide(),a(c.data("content")).fadeIn()},hideTabContent:function(b){var c=a(this.tabs[b]);a(c.data("content")).hide(),a(c.data("placeholder")).fadeIn()}}),a("[data-behavior='Composer']").length){var d=a("[data-behavior='Composer']").composer();d.hide();var e=a("ul.streams");e.length&&e.on("click","li",function(b){"stories"==a(this).data("stream")?d.fadeIn():d.fadeOut()})}a(c).ajaxSuccess(function(b,c,d){var e=a("a.connect-link");e.length&&!e.is(":data('tooltip')")&&a(e).tooltip({placement:"top",animation:!0,trigger:"hover"})})}(jQuery,window,document);