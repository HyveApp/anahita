/*! anahita 20-06-2015 */
!function(a,b,c){"use strict";a.widget("anahita.search",{options:{searchForm:'form[data-trigger="SearchRequest"]',sortOption:'select[data-trigger="SortOption"]',commentOption:'input[data-trigger="SearchOption"]',scope:'[data-trigger="ChangeScope"]',results:"#an-search-results",searchScopes:".search-scopes"},_create:function(){this.form=a(this.options.searchForm);var b=a(this.options.sortOption),c=a(this.options.commentOption),d=a(this.options.scope);this.searchOptions={layout:"results",sort:a(b).find("option:selected").val(),search_comments:a(c).is(":checked"),scope:a(d).data("scope")},this._on(this.form,{submit:function(a){a.preventDefault(),this.submit(this.form)}}),this._on(b,{change:function(b){b.preventDefault(),this.searchOptions.sort=a(b.currentTarget).find("option:selected").val(),this.submit(a(b.currentTarget))}}),this._on(c,{change:function(b){b.preventDefault(),this.searchOptions.search_comments=a(b.currentTarget).is(":checked"),this.submit(a(b.currentTarget))}}),this._initScopes()},_initScopes:function(){this._on(a(this.options.scope),{click:function(b){b.preventDefault(),this.searchOptions.scope=a(b.currentTarget).data("scope"),this.submit(a(b.currentTarget))}})},submit:function(b){var d=this;a.ajax({method:"get",url:this.form.attr("action")+"?"+this.form.serialize(),data:this.searchOptions,beforeSend:function(){b.fadeTo("fast",.3).addClass("uiActivityIndicator")},success:function(b,c,e){b=a(b),a(d.options.results).html(b.filter(".an-entity")),a(d.options.searchScopes).replaceWith(b.filter(d.options.searchScopes)),d._initScopes()},complete:function(){b.fadeTo("fast",1).removeClass("uiActivityIndicator");var e=d.form.attr("action")+"?"+d.form.serialize()+"&"+a.param(d.searchOptions);a(c).data("newUrl",e).trigger("urlChange")}})}}),a("body").search()}(jQuery,window,document);